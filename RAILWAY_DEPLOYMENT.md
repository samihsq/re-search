# Railway Deployment Guide

This guide shows how to deploy your Stanford Research Opportunities app to Railway using their managed services.

## üöÄ Quick Railway Deployment

### Step 1: Prepare Your Environment

Run the environment setup script:

```bash
./setup-env.sh
```

Edit the `.env` file and add your `GEMINI_API_KEY`.

### Step 2: Deploy to Railway

#### Option A: Using Railway CLI (Recommended)

1. **Install Railway CLI**:

   ```bash
   npm install -g @railway/cli
   ```

2. **Login to Railway**:

   ```bash
   railway login
   ```

3. **Deploy your app**:
   ```bash
   railway up
   ```

#### Option B: Using Railway Dashboard

1. Go to [Railway Dashboard](https://railway.app/dashboard)
2. Click "New Project"
3. Select "Deploy from GitHub repo"
4. Choose your repository
5. Railway will automatically detect the `Dockerfile`

### Step 3: Add Managed Services

Railway will deploy your main application, but you'll need to add managed services:

1. **Add PostgreSQL**:

   - In your Railway project, click "New Service"
   - Select "Database" ‚Üí "PostgreSQL"
   - Railway will automatically create a `DATABASE_URL` environment variable

2. **Add Redis**:
   - Click "New Service" again
   - Select "Database" ‚Üí "Redis"
   - Railway will automatically create a `REDIS_URL` environment variable

### Step 4: Configure Environment Variables

In your Railway project dashboard:

1. Go to your main service (the one with your code)
2. Click on "Variables" tab
3. Add these variables **manually** from your `.env` file:

**Required Manual Variables:**

- `GEMINI_API_KEY` - Your Google Gemini API key (get from [Google AI Studio](https://makersuite.google.com/app/apikey))
- `SECRET_KEY` - Generated by setup script (from your .env file)
- `SCRAPING_API_KEY` - Generated by setup script (from your .env file)
- `ENABLE_LLM_PARSING=true` - Enable LLM HTML parsing
- `DEBUG=false` - Disable debug mode for production
- `REACT_APP_API_URL` - Your Railway app URL (e.g., `https://your-app-name.railway.app`)

**Automatically Provided by Railway:**

- `DATABASE_URL` - PostgreSQL connection string (auto-generated when you add PostgreSQL service)
- `REDIS_URL` - Redis connection string (auto-generated when you add Redis service)

**Important**: Make sure you have added the PostgreSQL and Redis services first, then Railway will automatically create the `DATABASE_URL` and `REDIS_URL` environment variables.

### Step 5: Update Frontend Configuration

1. Get your Railway app URL from the dashboard
2. Update the `REACT_APP_API_URL` variable in Railway to point to your app URL
3. Redeploy if necessary

### Step 6: Set Up GitHub Actions

1. Go to your GitHub repository
2. Navigate to Settings ‚Üí Secrets and variables ‚Üí Actions
3. Add these secrets:
   - `RAILWAY_URL`: Your Railway app URL
   - `SCRAPING_API_KEY`: The same value from your Railway environment variables

## üîß Railway-Specific Configuration

### Environment Variables

Railway automatically provides these when you add managed services:

- `DATABASE_URL` - PostgreSQL connection string
- `REDIS_URL` - Redis connection string

You need to add these manually:

- `GEMINI_API_KEY` - Your Google Gemini API key
- `SECRET_KEY` - Generated by setup script
- `SCRAPING_API_KEY` - Generated by setup script
- `ENABLE_LLM_PARSING=true`
- `DEBUG=false`
- `REACT_APP_API_URL` - Your Railway app URL

### Networking

Railway automatically handles:

- HTTPS certificates
- Load balancing
- Auto-scaling
- Health checks

### Volumes

Railway manages data persistence automatically for:

- PostgreSQL database
- Redis cache

No manual volume configuration needed!

## üìä Monitoring

### Health Checks

Your app includes health check endpoints:

- `/health` - Main health check
- `/api/health` - API-specific health check

### Logs

View logs in the Railway dashboard:

1. Go to your project
2. Click on your service
3. Go to "Logs" tab

### Metrics

Railway provides built-in metrics:

- CPU usage
- Memory usage
- Request volume
- Response times

## üîÑ Daily Scraping

The GitHub Actions workflow will automatically:

1. Trigger daily at 2 AM UTC
2. Call your Railway app's scraping endpoint
3. Use the secure API key for authentication

## üí∞ Cost Optimization

### Railway Pricing

- **Free Tier**: $5 credit/month
- **Pro Plan**: $20/month

### Managed Services

- **PostgreSQL**: ~$5/month
- **Redis**: ~$3/month

### Total Cost

- Development: Free tier ($5 credit)
- Production: ~$8-15/month

## üõ†Ô∏è Troubleshooting

### Common Issues

1. **Build fails with start.sh not found error**:

   - ‚úÖ **Fixed**: The start script is now embedded directly in the Dockerfile
   - No external file dependency - the script is created during build

2. **Build fails with VOLUME error**:

   - ‚úÖ Fixed: We removed Docker Compose volumes
   - ‚úÖ Using Railway managed services instead

3. **Database connection fails**:

   - Ensure PostgreSQL service is added
   - Check `DATABASE_URL` is automatically set

4. **Redis connection fails**:

   - Ensure Redis service is added
   - Check `REDIS_URL` is automatically set

5. **Frontend not loading**:
   - Check `REACT_APP_API_URL` points to your Railway app
   - Verify the frontend build completed successfully

### Debug Commands

```bash
# Check Railway status
railway status

# View logs
railway logs

# Check environment variables
railway variables

# Connect to database
railway connect
```

## üöÄ Production Checklist

- [ ] PostgreSQL service added
- [ ] Redis service added
- [ ] All environment variables set
- [ ] `REACT_APP_API_URL` points to Railway app
- [ ] GitHub secrets configured
- [ ] Health checks passing
- [ ] Daily scraping workflow tested

## üîó Useful Links

- [Railway Documentation](https://docs.railway.app/)
- [Railway Managed Services](https://docs.railway.app/databases)
- [Railway Environment Variables](https://docs.railway.app/develop/variables)
- [Railway Volumes](https://docs.railway.app/reference/volumes)

---

Your app should now be deployed and running on Railway! üéâ
